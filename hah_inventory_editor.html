<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HealthAndHIT â€” Inventory Editor</title>
<style>
  :root{--bg:#101217;--panel:#171a20;--text:#e8e8ef;--muted:#a6a6b3;--accent:#ff4d4d;--ok:#3ad17c;--card:#1b1f27;--border:#2a2e38}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:#13161c;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:1.1rem}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button,input[type="file"]::file-selector-button{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:700}
  input[type="file"]{color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:6px 0}
  .title{font-weight:800}
  table{width:100%;border-collapse:collapse;margin-top:6px}
  th,td{border:1px solid var(--border);padding:6px;text-align:center}
  th{background:#12151b}
  input.qty{width:72px;background:#0f1218;border:1px solid var(--border);border-radius:8px;color:var(--text);padding:6px;text-align:center}
  .swatches{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .swatch{width:24px;height:24px;border-radius:999px;border:2px solid var(--border);cursor:pointer;position:relative;box-shadow:inset 0 0 0 2px rgba(0,0,0,.2)}
  .swatch[aria-pressed="true"]::after{content:"âœ“";position:absolute;inset:0;display:grid;place-items:center;font-size:14px;color:#fff;text-shadow:0 1px 2px #000}
  .muted{color:var(--muted);font-size:.9rem}
  .foot{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .ok{background:var(--ok)!important}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:.9rem}
</style>
</head>
<body>
  <header>
    <h1>ðŸ§° HealthAndHIT â€” Inventory Editor</h1>
    <div class="toolbar">
      <input type="file" id="file" accept="application/json">
      <button id="downloadBtn" class="ok">Download inventory.json</button>
    </div>
  </header>

  <div class="wrap">
    <p class="muted">Load your existing <b>inventory.json</b>, edit stock numbers and colour variants, then download the updated file to upload to your site.</p>
    <div id="products" class="grid"></div>
  </div>

<script>
const COLOR_OPTIONS=[
  {key:'black',name:'Black',hex:'#111'},
  {key:'white',name:'White',hex:'#fff'},
  {key:'red',name:'Red',hex:'#ff2b2b'},
  {key:'pink',name:'Pink',hex:'#ff6ea8'},
  {key:'blue',name:'Blue',hex:'#2b6cff'}
];
const SIZES=['S','M','L','XL','2XL','ONESIZE'];

// State
let data={}; // will match the schema described below

// Try to fetch inventory.json from same folder (best-effort)
fetch('inventory.json',{cache:'no-store'}).then(r=>r.ok?r.json():null).then(j=>{ if(j){ data=j; render(); }}).catch(()=>{});

// File loader
document.getElementById('file').addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  const text = await f.text();
  try{ data=JSON.parse(text); }catch(err){ alert('Invalid JSON file'); return; }
  render();
});

function normaliseProduct(pid){
  const rec=data[pid]||{};
  // If it already has COLORS, keep. Otherwise wrap existing size stock into a default colourless bucket.
  if(rec.COLORS){ return; }
  // Create "no-colour" bucket to preserve existing size-only stock
  data[pid]={ ...rec };
}

function render(){
  const host=document.getElementById('products'); host.innerHTML='';
  Object.keys(data).forEach(pid=>{
    normaliseProduct(pid);
    const rec=data[pid];
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`
      <div class="row"><span class="title mono">${pid}</span> <span class="muted">(toggle colours below; enter quantities by size)</span></div>
      <div class="swatches" data-swatches></div>
      <div class="row muted">If a colour is OFF it won't appear as selectable in the shop.</div>
      <div class="table-wrap"></div>
    `;
    const wrap=card.querySelector('[data-swatches]');

    // Ensure COLORS exists
    rec.COLORS = rec.COLORS || {};
    COLOR_OPTIONS.forEach(c=>{
      const on = !!rec.COLORS[c.key];
      const d=document.createElement('button');
      d.className='swatch'; d.type='button'; d.style.background=c.hex;
      d.setAttribute('title', c.name);
      d.setAttribute('aria-pressed', on ? 'true':'false');
      d.onclick=()=>{
        const now = d.getAttribute('aria-pressed')==='true';
        if(now){
          delete rec.COLORS[c.key];
          d.setAttribute('aria-pressed','false');
        }else{
          rec.COLORS[c.key] = rec.COLORS[c.key] || {}; // sizes will be added as edited
          d.setAttribute('aria-pressed','true');
        }
        drawTable();
      };
      wrap.appendChild(d);
    });

    const tblWrap=card.querySelector('.table-wrap');
    function drawTable(){
      const activeColors = Object.keys(rec.COLORS);
      if(activeColors.length===0){ tblWrap.innerHTML='<div class="muted">No colours enabled. Toggle at least one colour above.</div>'; return; }
      const rows = activeColors.map(ckey=>{
        const c=COLOR_OPTIONS.find(x=>x.key===ckey);
        const sizeInputs = SIZES.map(sz=>{
          const v = rec.COLORS[ckey][sz] ?? '';
          return `<td><input class="qty" data-ckey="${ckey}" data-size="${sz}" value="${v}" placeholder="0"></td>`;
        }).join('');
        return `<tr><th style="text-align:left"><span class="swatch" style="background:${c.hex}; width:14px;height:14px;border-width:1px;vertical-align:middle"></span> ${c.name} <span class="muted mono">(${ckey})</span></th>${sizeInputs}</tr>`;
      }).join('');
      tblWrap.innerHTML=`
        <table>
          <thead><tr><th>Colour</th>${SIZES.map(s=>`<th>${s}</th>`).join('')}</tr></thead>
          <tbody>${rows}</tbody>
        </table>
      `;
      tblWrap.querySelectorAll('input.qty').forEach(inp=>{
        inp.addEventListener('input',()=>{
          const ckey=inp.dataset.ckey, sz=inp.dataset.size;
          const n = inp.value.trim()==='' ? undefined : Math.max(0, parseInt(inp.value||'0',10)||0);
          if(n===undefined){ delete rec.COLORS[ckey][sz]; }
          else{ rec.COLORS[ckey][sz]=n; }
        });
      });
    }
    drawTable();

    host.appendChild(card);
  });
}

// Download JSON
document.getElementById('downloadBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='inventory.json'; a.click();
  URL.revokeObjectURL(a.href);
};
</script>
</body>
</html>