<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HealthAndHIT — Demo Shop (Inventory Enabled)</title>
<meta name="color-scheme" content="dark light">
<style>
  :root { --bg:#191a1e; --panel:#23242b; --card:#26272f; --accent:#ff3939; --text:#fff; --muted:#c9c9cf; --radius:14px; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{padding:16px;border-bottom:1px solid #2f3038;background:#1b1c22}
  h1{margin:0;font-size:1.1rem}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px}
  @media(min-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:1040px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{background:var(--card);border:1px solid #2c2d36;border-radius:var(--radius);overflow:hidden;display:grid;grid-template-rows:auto 1fr}
  .media{height:150px;display:flex;align-items:center;justify-content:center;background:#12131a}
  .media img{width:100%;height:100%;object-fit:contain}
  .body{padding:14px;display:flex;flex-direction:column;gap:10px}
  .title{font-weight:700;margin:0}
  .muted{color:var(--muted);font-size:.9rem}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select,input[type=number]{width:100%;padding:10px;border-radius:10px;border:1px solid #343542;background:#1f2027;color:#fff}
  .btn{border:0;border-radius:10px;padding:10px 12px;font-weight:700;background:var(--accent);color:#fff;cursor:pointer}
  .price{font-weight:800;color:#ffb923}
  .note{background:#1e1f26;border:1px solid #2c2d36;padding:10px;border-radius:10px;margin:10px 0}
  footer{padding:18px;color:#bbb}
</style>
</head>
<body>
<header><div class="wrap"><h1>HealthAndHIT — Demo Shop (Inventory Enabled)</h1></div></header>
<div class="wrap">
  <div class="note">This demo reads <code>inventory.json</code> to show per-size stock and disables sold-out sizes/products.
  Update stock using <b>admin.html</b> then replace <code>inventory.json</code> on your server.</div>
</div>
<section class="wrap">
  <div id="grid" class="grid"></div>
</section>
<footer class="wrap">Tip: Open <b>admin.html</b> to edit your stock and download an updated <code>inventory.json</code>.</footer>

<script>
/* ---------- Demo data (match your IDs/sizes) ---------- */
const PRODUCTS=[
  {id:'tee',      name:'HIT T-Shirt',         price:12.00, sizes:['S','M','L','XL','2XL'], img:'tshirt.jpg'},
  {id:'vest',     name:'HIT Vest',            price:18.00, sizes:['S','M','L','XL'],       img:'vest.png'},
  {id:'hoodie',   name:'HIT Hoodie',          price:38.00, sizes:['S','M','L','XL'],       img:'hoodie.png'},
  {id:'cap',      name:'HIT Cap (One Size)',  price:15.00, sizes:[],                       img:'cap.png'}
];
const currency=v=>'£'+(Math.round(v*100)/100).toFixed(2);
const grid=document.getElementById('grid');

/* ---------- Inventory loading ---------- */
let INVENTORY = {};
async function loadInventory(){
  try{
    const res = await fetch('inventory.json', {cache:'no-store'});
    if(!res.ok) throw new Error('fetch failed');
    INVENTORY = await res.json();
  }catch(err){
    console.warn('inventory.json missing — treating as unlimited stock');
    INVENTORY = {};
  }
}
const qtyFor = (pid, size) => {
  const rec = INVENTORY[pid];
  if(!rec) return Infinity;
  if(size) return (rec[size] ?? 0);
  if('ONESIZE' in rec) return rec['ONESIZE'];
  return 0;
};
const productSoldOut = (pid, sizes) => {
  if(!sizes || sizes.length===0) return qtyFor(pid,'') <= 0;
  return sizes.every(sz => qtyFor(pid, sz) <= 0);
};

/* ---------- Rendering ---------- */
function buildSizeControl(p){
  // No sizes? show ONESIZE count if present
  if(!p.sizes || p.sizes.length===0){
    const left = qtyFor(p.id,'');
    const badge = (left===Infinity) ? '' : `<span class="muted">Stock: ${left}</span>`;
    return `<input type="hidden" class="size"><span>${badge}</span>`;
  }
  const opts = p.sizes.map(sz=>{
    const left = qtyFor(p.id, sz);
    const text = `${sz} ${left===Infinity?'':'(' + left + ')'}`;
    const disabled = (left<=0) ? 'disabled' : '';
    return `<option value="${sz}" ${disabled}>${text}${left<=0?' — Sold out':''}</option>`;
  }).join('');
  return `<select class="size"><option value="">Size</option>${opts}</select>`;
}

function render(){
  grid.innerHTML='';
  PRODUCTS.forEach(p=>{
    const soldOut = productSoldOut(p.id, p.sizes);
    const card=document.createElement('article');
    card.className='card';
    card.innerHTML=`
      <div class="media"><img src="${p.img}" alt="${p.name}" onerror="this.src='comingsoon.png'"></div>
      <div class="body">
        <div>
          <h3 class="title">${p.name} ${soldOut?'<span class="muted">— Sold out</span>':''}</h3>
          <div class="row"><span class="price">${currency(p.price)}</span></div>
          <div class="row">${buildSizeControl(p)}</div>
        </div>
        <div class="row">
          <button class="btn add" ${soldOut?'disabled':''}>${soldOut?'Sold out':'Add to Basket'}</button>
        </div>
      </div>`;

    card.querySelector('.add').onclick=()=>{
      let chosenSize='';
      if(p.sizes && p.sizes.length){
        const sel=card.querySelector('select.size');
        if(!sel.value){ alert('Choose a size'); return; }
        chosenSize = sel.value;
        const left = qtyFor(p.id, chosenSize);
        if(left<=0){ alert('That size is sold out'); return; }
        alert(`Added 1 × ${p.name} (${chosenSize}). Remaining stock shown in dropdown.`);
        // This demo does not modify inventory.json (static site).
        // You update counts via admin.html and re-upload inventory.json.
      }else{
        const left = qtyFor(p.id,'');
        if(left<=0){ alert('Sold out'); return; }
        alert(`Added 1 × ${p.name}.`);
      }
    };

    grid.appendChild(card);
  });
}

(async function(){
  await loadInventory();
  render();
  // Hot reload on Ctrl+R (normal refresh) will re-fetch inventory.json with no-store cache
})();
</script>
</body>
</html>
